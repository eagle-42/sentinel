# ğŸš€ RÃ¨gles Windsurf/Cascade pour Sentinel2

**Projet** : Sentinel2 - SystÃ¨me de Trading Algorithmique TDD  
**Version** : 2.0  
**Assistant** : Cascade (powered by Claude via Windsurf)  
**Statut** : âœ… **PROJET FINALISÃ‰ ET VALIDÃ‰**

---

## ğŸ“‹ **RÃˆGLES FONDAMENTALES**

### **1. Architecture TDD Stricte**
- **Tests AVANT implÃ©mentation** : Toujours Ã©crire les tests en premier
- **100% de succÃ¨s requis** : Aucun code ne passe si les tests Ã©chouent
- **Couverture minimale** : 80% (actuellement 43%, en amÃ©lioration)
- **Types de tests** : Unit (99 tests), Integration (11 tests), E2E

### **2. Constantes et Configuration**
- **âŒ JAMAIS de variables en brut** : Toujours utiliser `src/constants.py`
- **âŒ JAMAIS de chemins en brut** : Utiliser `CONSTANTS.get_data_path()`
- **âœ… Configuration centralisÃ©e** : `src/constants.py` + `config/`
- **âœ… Variables d'environnement** : Toutes dans `.env` (jamais en dur)

### **3. Architecture Modulaire**
- **Fonctions < 100 lignes** : Refactoriser si dÃ©passement
- **Classes spÃ©cialisÃ©es** : Une responsabilitÃ© par classe
- **SÃ©paration des responsabilitÃ©s** : Respect du principe SOLID
- **Imports organisÃ©s** : Standard â†’ Tiers â†’ Local (toujours en haut)

---

## ğŸ—ï¸ **PRINCIPES D'ARCHITECTURE (DRY, API UnifiÃ©e, Validation)**

### **RÃˆGLE A1 : DRY (Don't Repeat Yourself) - OBLIGATOIRE**
- **âŒ INTERDICTION ABSOLUE** de dupliquer la logique mÃ©tier
- **âœ… TOUJOURS** crÃ©er une mÃ©thode gÃ©nÃ©rique rÃ©utilisable
- **Principe** : Si la mÃªme logique apparaÃ®t 2+ fois avec variations mineures, factoriser
- **Approche** : Identifier parties communes â†’ CrÃ©er mÃ©thode gÃ©nÃ©rique â†’ ParamÃ©trer diffÃ©rences

### **RÃˆGLE A2 : API UnifiÃ©e - OBLIGATOIRE**
- **âŒ INTERDICTION** de crÃ©er multiples mÃ©thodes similaires
- **âœ… TOUJOURS** crÃ©er interface unique avec paramÃ¨tre discriminant (`type`, `mode`, `category`)
- **Avantages** : API cohÃ©rente, validation centralisÃ©e, extensibilitÃ©

### **RÃˆGLE A3 : Validation Stricte - OBLIGATOIRE**
- **âœ… TOUJOURS** valider paramÃ¨tres d'entrÃ©e
- **âœ… TOUJOURS** lever `ValueError` si invalide
- **âœ… TOUJOURS** documenter valeurs acceptÃ©es
```python
if param not in VALEURS_ACCEPTEES:
    raise ValueError(f"Invalide: {param}. AcceptÃ©es: {VALEURS_ACCEPTEES}")
```

### **RÃˆGLE A4 : Architecture en Couches - OBLIGATOIRE**
Structure obligatoire :
```
Appelants (scripts, modules)
    â†“
Interface Publique (API simple, validation, routing)
    â†“
ImplÃ©mentation PrivÃ©e (_methods: logique rÃ©utilisable)
```

### **RÃˆGLE A5 : Refactoring Progressif - PROCESS OBLIGATOIRE**
1. **Identifier** : Code rÃ©pÃ©tÃ© 2+ fois
2. **CrÃ©er** : MÃ©thode gÃ©nÃ©rique + tests AVANT migration
3. **Migrer** : Remplacer appelants UN PAR UN
4. **Tester** : Valider aprÃ¨s chaque migration
5. **Nettoyer** : Supprimer ancien code quand tout migrÃ©
**âŒ JAMAIS** de refactoring "big bang"

### **RÃˆGLE A6 : SÃ©curitÃ© Secrets - INTERDICTION ABSOLUE**
- **âŒ JAMAIS** de secrets/clÃ©s hardcodÃ©s
- **âŒ JAMAIS** de valeur par dÃ©faut pour secrets
- **âœ… TOUJOURS** variables d'environnement SANS dÃ©faut
```python
SECRET = os.getenv("SECRET_NAME")
if not SECRET:
    raise ValueError("SECRET_NAME manquante dans .env")
```

### **RÃˆGLE A7 : Documentation - OBLIGATOIRE**
Format docstring obligatoire :
```python
def method(self, param: Type, option: str = None) -> ReturnType:
    """Description courte
    
    Args:
        param: Description
        option: Valeurs ("val1", "val2", "val3")
        
    Returns:
        Description retour
        
    Raises:
        ValueError: Conditions erreur
    """
```

---

## ğŸš¨ **INTERDICTIONS ABSOLUES**

### **âŒ JAMAIS DE SIMULATIONS (CRITIQUE)**
- **âŒ JAMAIS de prix simulÃ©s** : Uniquement donnÃ©es rÃ©elles du marchÃ©
- **âŒ JAMAIS de donnÃ©es artificielles** : Pas de fallback avec simulation
- **âœ… SEULE EXCEPTION** : Tests unitaires avec mocks

### **âŒ JAMAIS DE PATCHING ADDITIONNEL**
- **âŒ JAMAIS de fichiers temporaires** : Corriger imports existants
- **âŒ JAMAIS de chemins cassÃ©s** : Utiliser modules existants

### **âŒ JAMAIS D'IMPORTS DANS LE CODE**
- **âŒ JAMAIS dans fonctions** : Tous en haut du fichier
- **âŒ JAMAIS conditionnels** : Pas d'imports dynamiques
- **âœ… TOUJOURS organisÃ©s** : Standard, tiers, local

---

## ğŸ“Š **STOCKAGE PARQUET**

### **UN SEUL FICHIER PAR TYPE**
- **âŒ PAS de doublons** : Ne jamais crÃ©er plusieurs fichiers parquet
- **âœ… Sauvegarde incrÃ©mentale** : Ajouter au fichier existant
- **âœ… CohÃ©rence** : `spy_15min.parquet`, `spy_news.parquet`

---

## ğŸ”§ **WORKFLOW DÃ‰VELOPPEMENT**

### **Avant Modification**
1. Lire README.md - Comprendre architecture
2. VÃ©rifier tests - Tous passent (100%)
3. Consulter constants.py - Constantes existantes

### **Pendant Modification**
1. Tests d'abord (TDD)
2. Petits commits
3. Respect architecture
4. Documentation (docstrings + type hints)

### **AprÃ¨s Modification**
1. Tests complets : `uv run python scripts/test_system.py`
2. VÃ©rifier fonctionnement rÃ©el
3. Mettre Ã  jour doc si nÃ©cessaire

---

## âœ… **CHECKLIST RÃ‰VISION CODE (avant commit)**

- [ ] Aucune duplication (DRY)
- [ ] API cohÃ©rente et unifiÃ©e
- [ ] Validation stricte ValueError
- [ ] Documentation complÃ¨te
- [ ] Tests couvrent nouveau code
- [ ] Architecture en couches
- [ ] Aucun secret en dur
- [ ] Imports en haut fichier

---

## ğŸ¯ **WORKFLOW CASCADE**

### **1. Analyse**
- Comprendre requÃªte
- Identifier modules concernÃ©s
- VÃ©rifier constantes

### **2. Planification**
- Plan d'action
- Tests nÃ©cessaires
- Impact architecture
- Demander confirmation si majeur

### **3. ImplÃ©mentation**
- Tests d'abord (TDD)
- Code minimal
- RÃ¨gles architecture
- Documentation

### **4. VÃ©rification**
- Tests 100% succÃ¨s
- Fonctionnement rÃ©el
- Logs sans erreur

### **5. Finalisation**
- Documentation Ã  jour
- Confirmation utilisateur

---

## ğŸš¨ **RÃˆGLES CRITIQUES (RÃ‰SUMÃ‰)**

1. **âŒ JAMAIS** code sans tests (TDD obligatoire)
2. **âŒ JAMAIS** variables en brut (constants.py)
3. **âŒ JAMAIS** simulations (donnÃ©es rÃ©elles)
4. **âŒ JAMAIS** doublons Parquet (un fichier/type)
5. **âŒ JAMAIS** imports dans code (tous en haut)
6. **âŒ JAMAIS** secrets en dur (.env obligatoire)
7. **âŒ JAMAIS** duplication logique (DRY)
8. **âœ… TOUJOURS** demander confirmation (changements majeurs)
9. **âœ… TOUJOURS** vÃ©rifier avant finir (tester app)
10. **âœ… TOUJOURS** respecter architecture (structure modulaire)

---

## ğŸ“š **RESSOURCES**

### **Documentation**
- **README.md** : Documentation principale
- **docs/ARCHITECTURE_PRINCIPLES.md** : Principes dÃ©taillÃ©s
- **.cascade/architecture_rules.md** : RÃ¨gles complÃ¨tes

### **Configuration**
- **.env** : Variables environnement (jamais commitÃ©)
- **config/** : Configuration JSON
- **src/constants.py** : Constantes globales

---

**Ces rÃ¨gles doivent Ãªtre respectÃ©es Ã  CHAQUE interaction avec Sentinel2.**

**Projet** : Sentinel2  
**Version** : 2.0  
**Statut** : âœ… FinalisÃ© et ValidÃ©  
**Assistant** : Cascade (Windsurf)
